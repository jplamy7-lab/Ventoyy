# À placer dans /boot/grub/grub.cfg sur la partition de boot
set timeout=10
set default=0

insmod regexp
insmod ext2
insmod loopback

menuentry "Rechercher les systèmes ISO..." {
    # On définit où chercher
    set isopath="/iso"
    
    # Boucle sur tous les fichiers .iso du dossier /iso
    for isofile in (*,gpt1)$isopath/*.iso; do
        regexp --set=isofile_name '^.*/([^/]+)$' "$isofile"
        
        menuentry "Boot: $isofile_name" $isofile {
            set isofile=$2
            loopback loop $isofile
            # Ici, on tente un boot générique (cas Linux classique)
            linux (loop)/casper/vmlinuz boot=casper iso-scan/filename=$isofile quiet splash
            initrd (loop)/casper/initrd.lz
        }
    done
}
